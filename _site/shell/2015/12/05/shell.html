<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Somethign about Shell</title>
  <meta name="description" content="[转载自：]http://blog.csdn.net/anders_zhuo/article/details/8644207">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://yourdomain.com/shell/2015/12/05/shell.html">
  <link rel="alternate" type="application/rss+xml" title="Coding Hard" href="http://yourdomain.com/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Coding Hard</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Somethign about Shell</h1>
    <p class="post-meta"><time datetime="2015-12-05T00:12:34+08:00" itemprop="datePublished">Dec 5, 2015</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>[转载自：]<a href="http://blog.csdn.net/anders_zhuo/article/details/8644207">http://blog.csdn.net/anders_zhuo/article/details/8644207</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">echo</span> -n <span class="s2">"Enter your name:"</span>
<span class="nb">read
echo</span> <span class="s2">"read without anyvariables:REPLY=</span><span class="nv">$REPLY</span><span class="s2">"</span>
<span class="nb">echo</span> -n <span class="s2">"Enter your age:"</span>
<span class="nb">read </span>age
<span class="nb">echo</span> <span class="s2">"read with variable:Age=</span><span class="nv">$age</span><span class="s2"> and REPLY=</span><span class="nv">$REPLY</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"which one are you skilledin?"</span>
<span class="k">select </span>var <span class="k">in</span> <span class="s2">"shell"</span> <span class="s2">"java"</span> <span class="s2">"c++"</span> <span class="s2">"c"</span> <span class="s2">"php"</span> <span class="s2">"c#"</span>
<span class="k">do
	</span><span class="nb">echo</span> <span class="s2">"the </span><span class="se">\$</span><span class="s2">REPLY=</span><span class="nv">$REPLY</span><span class="s2">"</span>
	<span class="nb">echo</span> <span class="s2">"you are skilled in </span><span class="nv">$var</span><span class="s2">"</span>
	<span class="nb">break
</span><span class="k">done

</span><span class="nv">count</span><span class="o">=</span>1
<span class="nv">MAX</span><span class="o">=</span>5	
<span class="k">while</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$SECONDS</span><span class="s2">"</span> -le <span class="s2">"</span><span class="nv">$MAX</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">do
	</span><span class="nb">echo</span> <span class="s2">"this is the </span><span class="nv">$count</span><span class="s2"> time to sleep!"</span>
	<span class="nb">let </span><span class="nv">count</span><span class="o">=</span><span class="nv">$count</span>+1
	sleep 2
<span class="k">done
</span><span class="nb">echo</span> <span class="s2">"this script runs </span><span class="nv">$SECONDS</span><span class="s2"> seconds!"</span>

<span class="c"># strlen(str) ${#str} or exptr length $string</span>

<span class="c"># expr index $string $substring</span>
<span class="c"># expr index "Speeding up small jobs in Hadoop" jobs</span>
<span class="c"># 0x13</span>

<span class="c"># get substring	</span>
<span class="c">#{string:position:length} </span>
<span class="c">#{...} # 从零开始标记字符串 from left to right</span>

<span class="c">#{string: -position} #冒号和横杆之间有空格 从右边开始取</span>
<span class="c">#{string:(position)} </span>
expr substr <span class="nv">$string</span> <span class="nv">$position</span> <span class="nv">$length</span> <span class="c">#从名称为$string的字符串的第#position位置开始		取长度为$length的子串</span>

delete sunstring
<span class="k">${</span><span class="nv">string</span><span class="p">#substring</span><span class="k">}</span> <span class="c">#删除string开头处与substring匹配的最短子串</span>
<span class="k">${</span><span class="nv">string</span><span class="p">##substring</span><span class="k">}</span> <span class="c">#删除string子串与substring匹配的最长子串</span>
<span class="k">${</span><span class="nv">string</span><span class="p">%substring</span><span class="k">}</span> <span class="c">#删除string结尾处与substring匹配的最短子串</span>
<span class="k">${</span><span class="nv">string</span><span class="p">%%substring</span><span class="k">}</span> <span class="c">#删除string结尾处与substring匹配的最长子串</span>


eg
定义一个字符串   20121114ReadingHadoop
ming@ming-F83VF:~/shellpractice/chapter9<span class="nv">$anotherstr</span><span class="o">=</span>20121114ReadingHadoop
ming@ming-F83VF:~/shellpractice/chapter9<span class="nv">$echo</span> <span class="nv">$anotherstr</span>
20121114ReadingHadoop
删除开头处 以 2开始1结尾的  最短字符串！！
ming@ming-F83VF:~/shellpractice/chapter9<span class="nv">$echo</span> <span class="k">${</span><span class="nv">anotherstr</span><span class="p">#2*1</span><span class="k">}</span>
21114ReadingHadoop
删除开头处 以 2开始1结尾的  最长字符串！！
ming@ming-F83VF:~/shellpractice/chapter9<span class="nv">$echo</span> <span class="k">${</span><span class="nv">anotherstr</span><span class="p">##2*1</span><span class="k">}</span>
4ReadingHadoop
删除结尾处 以 a开始p结尾的  最短字符串！！
ming@ming-F83VF:~/shellpractice/chapter9<span class="nv">$echo</span> <span class="k">${</span><span class="nv">anotherstr</span><span class="p">%a*p</span><span class="k">}</span>
20121114ReadingH
删除结尾处 以 a开始p结尾的  最长字符串！！
ming@ming-F83VF:~/shellpractice/chapter9<span class="nv">$echo</span> <span class="k">${</span><span class="nv">anotherstr</span><span class="p">%%a*p</span><span class="k">}</span>
20121114Re

5 替换子串
替换子串命令都是<span class="k">${</span><span class="p">…</span><span class="k">}</span>格式，可以在任意处、开头处和结尾处替换满足条件的子串
<span class="k">${</span><span class="nv">string</span><span class="p">/substring/replacement</span><span class="k">}</span>    <span class="c">#仅替换第一次与substring相匹配的子串  </span>
 	<span class="k">${</span><span class="nv">string</span><span class="p">//substring/replacement</span><span class="k">}</span>   <span class="c">#替换所有与substring相匹配的子串  </span>
<span class="k">${</span><span class="nv">string</span><span class="p">/#substring/replacement</span><span class="k">}</span>   <span class="c">#替换string开头处与substring相匹配的子串  </span>
 	<span class="k">${</span><span class="nv">string</span><span class="p">/%substring/replacement</span><span class="k">}</span>   <span class="c">#替换string结尾处与substring相匹配的子串  </span>
</code></pre>
</div>

<h2 id="io">IO重定向</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>	I/O重定向是一个过程，这个过程捕捉一个文件、或命令、或程序、或脚本、甚至代码块（code block）的输出，然后把捕捉到的输出，作为输入发送给另外一个文件、或命令、或程序、或脚本
	
	文件标识符是从0开始到9结束的整数，指明了与进程相关的特定数据流的源
	
	Linux系统启动一个进程（该进程可能用于执行Shell命令）时，将自动为该进程打开三个文件：标准输入、标准输出和标准错误输出，分别由文件标识符0、1、2标识

	Shell命令从标准输入读取输入数据，将输出送到标准输出，如果该命令在执行过程中发生错误，则将错误信息输出到标准错误输出，默认情况下，标准输入与键盘输入相关联，标准输出和标准错误输出与显示器相关联
"" 标准输出： ""
例1
	cat和&gt;符号结合成为简易文本编辑器
	cat命令后不加任何参数时，cat命令的输入是标准输入，即键盘输入
	利用I/O重定向符号“&gt;”将键盘输入写入文件
	cat &gt; newfile后，就可输入需要写到newfile的内容，最后按CTRL+D结束对newfile的编辑

例2
	&gt;&gt;符号用于在已有文件后追加一些文本
	eg
	ls &gt;&gt;newfile  只是追加并没有把原来的覆盖掉
	ls &gt;newfile   将文件清空，然后将内容写进去

例3
	&gt;|符号是强制覆盖文件的符号，它与Shell的noclobber选项有关系，如果noclobber选项开启，表		示不允许覆盖任何文件，而&gt;|符号则可以不管noclobber选项的作用，强制将文件覆盖
	eg
	ming@ming-F83VF:~/shellpractice/chapter10$set -C  noclobber选项开启
	ming@ming-F83VF:~/shellpractice/chapter10$date &gt;newfile
	bash: newfile: 无法覆盖已存在的文件

	ming@ming-F83VF:~/shellpractice/chapter10$date &gt;|newfile
	ming@ming-F83VF:~/shellpractice/chapter10$cat newfile
	2012年 11月 10日 星期日 09:47:25 CST
</code></pre>
</div>

<h3 id="section">标准错误输出：</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>1
重定向标准错误输出，需要使用文件标识符2
 	2&gt; newfile
</code></pre>
</div>

 	eg 
<div class="highlighter-rouge"><pre class="highlight"><code>ming@ming-F83VF:~/shellpractice/chapter10$ ls 22*&gt;newfile 此时是将标准输出到	newfile中  但是屏幕中还是会输出，因为他是标准输出 
ls: 无法访问22*: 没有那个文件或目录
ming@ming-F83VF:~/shellpractice/chapter10$ls 22* 2&gt;newfile 
此时是将标准错误输出到	newfile中所以屏幕中没有任何输出
ming@ming-F83VF:~/shellpractice/chapter10$cat newfile
ls: 无法访问22*: 没有那个文件或目录

2
&lt; 是I/O重定向的输入符号，它可将文件内容写到标准输入之中
 
ming@ming-F83VF:~/shellpractice/chapter10$ wc -l &lt;newfile
1
这个newfile作为标准输入到wc 所以wc得到的内容只是newfile的内容！！
所以他不会知道这是哪个文件！所以只是打印出了文件行数
 
ming@ming-F83VF:~/shellpractice/chapter10$wc -l newfile
1 newfile
这个newfile作为wc命令的 操作文件。此时wc知道他要计数的是哪个文件，所以能打印出newfile文件名，因此既打印出了行数也打印出了文件名
 
&lt;&lt;delimiter  这个比较重要！！！
符号称为此处文档（Here-document），delimiter称为分界符，该符号表明：Shell将分界符delimiter之后直至下一个delimiter之前的所有内容作为输入
 
ming@ming-F83VF:~/shellpractice/chapter10$cat &gt;newfile &lt;&lt;CLOUD
&gt; hello cloud
&gt; hadoop
&gt; nosql
&gt; CLOUD
(剖析：cat&gt;newfile 是将标准输入到newfile文件中，即键盘输入newfile&lt;&lt;CLOUD是将输入到CLOUD之前的内容作为标准输入在此之前是用ctrl+d 结束标准输入，而使用&lt;&lt;  则是吧CLOUD作为结束标准输入)
 
ming@ming-F83VF:~/shellpractice/chapter10$cat newfile
hello cloud
hadoop
nosql
</code></pre>
</div>

 	1) 内建命令 
<div class="highlighter-rouge"><pre class="highlight"><code>	父子Shell是相对的，描述了两个Shell进程的fork关系，父Shell指在控制终端或xterm窗口给出提示符的进程，子Shell是由父Shell创建的进程
	Shell命令可分为内建命令（built-incommand）和外部命令（external command）内建命令是由Shell本身执行的命令
	外部命令由fork出来的子Shell执行
	内建命令不创建子Shell，外部命令创建子Shell，因此，内建命令的执行速度要比外部命令快

2) 冒号: 冒号表示永真 相当于 TRUE 关键字
	eg
	#!/bin/bash
	declare -i i=0
	while : ;
	do
		if [ $i -eq 10 ]; then
			break
		fi
		echo $((++i))
	done
	
	# 冒号可以被用来清空文件 
	# :&gt;filename  

3) 圆括号可以将其中的命令运行在子shell中
	(
		command1
		command2
		...
	)
	
  # BASH_SUBSHELL 该变量记录了 shell 的层次·
  eg
	#!/bin/bash
	echo "the level of father shell is $BASH_SUBSHELL"
	outvar=outvar
	(
	 echo "the level of sub shell is $BASH_SUBSHELL"
	 innervar=innervar
	 echo "outvar=$outvar" #子shell继承了父shell的变量
	 echo "innervar=$innervar"
	)
	echo "the level of father shell is $BASH_SUBSHELL"
	if [ -z $innervar ]
	then
		echo "the innervar is $innervar"
	else
		echo "the outvar is $outvar"
	fi
result:
	the level of father shell is 0
	the level of sub shell is 1
	outvar=outvar
	innervar=innervar
	the level of father shell is 0
	the innervar is
	
由此可见：
	子shell继承父shell的变量，而父shell不会得到子shell的变量
	另外父shell也不能使用子shell定义的环境变量

4) Shell 的限制模式
   以前的Shell模式都是运行在正常模式下的，shell还有一种模式称为限制模式，简称rsh(Restricted Shell),处于限制模式下的shell运行一段代码或者片段，将会禁用一些命令或操作。
   shell的限制模式是Linux系统基于安全方面的考虑，目地是为了限制脚本用户的权限，尽可能的减小脚本所带来的危害。


   bash Shell的限制模式借鉴了Korn Shell的限制性命令和操作，限制的命令和操作包含如下几方面：
   用cd命令更改当前工作目录的命令
   更改重要环境变量的值，包括$PATH、$SHELL、$BASH_ENV、$ENV和$SHELLOPTS
   输出重定向符号，包括&gt;、&gt;&gt;、&gt;|、&gt;&amp;、&lt;&gt;和&amp;&gt;符号
   调用含有一个或多个斜杠（/）的命令名称
   使用内建命令exec
   使用set +r等命令关闭限制模式
   使脚本运行在限制性模式下的两种方式：
   第一种：set -r命令开启restricted选项
   第二种：  #!后的语句改成/bin/bash -r

5) 进程号和作业号 
   进程号和作业号
   Linux系统为每个进程分配一个数字以标识这个进程，这个数字就是进程号
   创建该进程的Shell为此进程创建一个数字，也用于标识这个进程，这个数字称为作业号
   作业号标识的是在此Shell下运行的所有进程，我们知道，Linux是多用户的系统，多用户可能开启了多个Shell，进程号就标识了整个系统下正在运行的所有进程
   举例说明：
   [root@jselab shell-book]# grep -r"root" /etc/* | sort &gt; part1 &amp;
 	   [1] 4693
   [root@jselab shell-book]# grep -r"root" /usr/local/* | sort &gt; part2 &amp;
   [2] 4695		  

   作业有两种运行方式：前台运行和后台运行
   前台运行的作业指作业能够控制当前终端或窗口，且能接收用户的输入
   后台运行的作业则不在当前激活的终端或窗口中运行，是在用户“看不见”的情况下运行
   内建命令fg可将后台运行的作业放到前台，
   而&amp;符号使得作业后台运行，
 
   CTRL+Z组合键可以使作业转入阻塞态，
   bg命令可使阻塞态作业转入后台运行
   fg、bg和jobs命令只能以作业号为参数来指定作业，这三个命令是不能使用进程号的
   disown命令用于从Shell的作业表中删除作业，作业表指得就是由jobs命令所列出的作业列表
   wait命令用于等待后台作业完成，

6) 信号

   信号是Linux进程间通信的一个重要而复杂的概念，信号是在软件层次上对中断机制的一种模拟
   信号是异步的，一个进程不必通过任何操作来等待信号的到达，事实上，进程也不知道信号到底什么时候到达
   信号来源：硬件来源和软件来源
   组合键
   信号类型
   意义
       CTRL+C 	INT信号，即interrupt信号 	停止当前运行的作业
   CTRL+Z	TSTP信号，即terminal stop信号	使当前运行的作业暂时停止（转入阻塞态）
   CTRL+\	QUIT信号			CTRL+C的强化版本，当CTRL+C无法停止作业时，使用此组合键
   CTRL+Y	TSTP信号，即terminal stop信号	当进程从终端读取输入数据时，暂时停止该进程
   对于shell能执行  停止 暂停等功能，是因为向shell发送了了信号。
   如表中信号：INT TSTP等
 
   CTRL+C，INT信号，退出作业
   CTRL+\, QUIT信号， CTRL+C的强化版本
   CTRL+Y组合键实际上与CTRL+Z组合键是类似的，都是向进程发送TSTP信号，表示将进程暂时停止
   kill命令可以通过进程号、作业号或进程命令名向任何作业发送信号
   kill –l列出kill命令能发出的所有信号


7) trap命令
  trap是Linux的内建命令，它用于捕捉信号
  指定收到某种信号时所执行的命令
  trap command sig1 sig2 …sigN
   trap命令表示当收到sig1、sig2、…、sigN中任意一个信号时，执行command命令，command命令完成后脚本继续收到信号前的操作，直到脚本执行结束
  eg
    [plain] view plaincopy
    #!/bin/bash  
    trap "echo 'execute trap !'" INT  #接收 INT信号 即ctrl + c  
    count=1  
    while : ;  
    do  
    	echo "this is $count"  
 		let "count+=1"  
 		sleep 5  
    done  
   运行结果：每当　按下ctrl+c的时候都会被trap接收到，然后执行引号中的命令
   anders@anders-virtual-machine:~/code/shell/subandthread$./trap1.sh
   this is 1
   this is 2
   ^Cexecute trap !
   this is 3
   ^Cexecute trap !
   this is 4
   ^Cexecute trap !
   trap命令还可以
   忽略某些信号，即进程收到某些信号后不做任何处理，我们只要简单将trap命令的command用空字符串代替即可（""或''）
	#!/bin/bash 
	trap "" TERM SIGKILL INT 
	while :; do
		#let count=count+1
 			#echo "This is the $count sleep"
 			sleep 5
	done
</code></pre>
</div>


  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Coding Hard</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Coding Hard</li>
          <li><a href="mailto:1160931867@qq.com">1160931867@qq.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/SharkPre"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">SharkPre</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/jekyllrb"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">jekyllrb</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Talk is cheap, show me the code
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
